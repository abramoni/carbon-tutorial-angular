/**
 *
 * carbon-angular v0.0.0 | tab-headers.component.js
 *
 * Copyright 2014, 2022 IBM
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0

 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


import { Component, QueryList, Input, HostListener, ViewChild, ContentChildren, ViewChildren, ElementRef, TemplateRef, ChangeDetectorRef } from "@angular/core";
import { EventService } from "carbon-components-angular/utils";
import { I18n } from "carbon-components-angular/i18n";
import { Tab } from "./tab.component";
/**
 * The `TabHeaders` component contains the `Tab` items and controls scroll functionality
 * if content has overflow.
 */
var TabHeaders = /** @class */ (function () {
    function TabHeaders(elementRef, changeDetectorRef, eventService, i18n) {
        this.elementRef = elementRef;
        this.changeDetectorRef = changeDetectorRef;
        this.eventService = eventService;
        this.i18n = i18n;
        /**
         * Set to 'true' to have `Tab` items cached and not reloaded on tab switching.
         * Duplicate from `n-tabs` to support standalone headers
         */
        this.cacheActive = false;
        /**
         * Set to `true` to put tabs in a loading state.
         */
        this.skeleton = false;
        this.type = "default";
        this.translations = this.i18n.get().PAGINATION;
        /**
         * The index of the first visible tab.
         */
        this.firstVisibleTab = 0;
        // width of the overflow buttons
        this.OVERFLOW_BUTTON_OFFSET = 40;
    }
    Object.defineProperty(TabHeaders.prototype, "hasHorizontalOverflow", {
        get: function () {
            var tabList = this.headerContainer.nativeElement;
            return tabList.scrollWidth > tabList.clientWidth;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TabHeaders.prototype, "leftOverflowNavButtonHidden", {
        get: function () {
            var tabList = this.headerContainer.nativeElement;
            return !this.hasHorizontalOverflow || !tabList.scrollLeft;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TabHeaders.prototype, "rightOverflowNavButtonHidden", {
        get: function () {
            var tabList = this.headerContainer.nativeElement;
            return !this.hasHorizontalOverflow ||
                (tabList.scrollLeft + tabList.clientWidth) === tabList.scrollWidth;
        },
        enumerable: true,
        configurable: true
    });
    // keyboard accessibility
    /**
     * Controls the keydown events used for tabbing through the headings.
     */
    TabHeaders.prototype.keyboardInput = function (event) {
        var tabsArray = Array.from(this.tabs);
        // "Right" is an ie11 specific value
        if (event.key === "Right" || event.key === "ArrowRight") {
            if (this.currentSelectedTab < this.allTabHeaders.length - 1) {
                event.preventDefault();
                if (this.followFocus) {
                    this.selectTab(event.target, tabsArray[this.currentSelectedTab + 1], this.currentSelectedTab);
                }
                this.allTabHeaders.toArray()[this.currentSelectedTab + 1].nativeElement.focus();
            }
            else {
                event.preventDefault();
                if (this.followFocus) {
                    this.selectTab(event.target, tabsArray[0], 0);
                }
                this.allTabHeaders.first.nativeElement.focus();
            }
        }
        // "Left" is an ie11 specific value
        if (event.key === "Left" || event.key === "ArrowLeft") {
            if (this.currentSelectedTab > 0) {
                event.preventDefault();
                if (this.followFocus) {
                    this.selectTab(event.target, tabsArray[this.currentSelectedTab - 1], this.currentSelectedTab);
                }
                this.allTabHeaders.toArray()[this.currentSelectedTab - 1].nativeElement.focus();
            }
            else {
                event.preventDefault();
                if (this.followFocus) {
                    this.selectTab(event.target, tabsArray[this.allTabHeaders.length - 1], this.allTabHeaders.length);
                }
                this.allTabHeaders.toArray()[this.allTabHeaders.length - 1].nativeElement.focus();
            }
        }
        if (event.key === "Home") {
            event.preventDefault();
            if (this.followFocus) {
                this.selectTab(event.target, tabsArray[0], 0);
            }
            this.allTabHeaders.toArray()[0].nativeElement.focus();
        }
        if (event.key === "End") {
            event.preventDefault();
            if (this.followFocus) {
                this.selectTab(event.target, tabsArray[this.allTabHeaders.length - 1], this.allTabHeaders.length);
            }
            this.allTabHeaders.toArray()[this.allTabHeaders.length - 1].nativeElement.focus();
        }
        // `"Spacebar"` is IE11 specific value
        if ((event.key === " " || event.key === "Spacebar") && !this.followFocus) {
            this.selectTab(event.target, tabsArray[this.currentSelectedTab], this.currentSelectedTab);
        }
    };
    TabHeaders.prototype.ngOnInit = function () {
        var _this = this;
        this.eventService.on(window, "resize", function () { return _this.handleScroll(); });
    };
    TabHeaders.prototype.ngAfterContentInit = function () {
        var _this = this;
        if (!this.tabInput) {
            this.tabs = this.tabQuery;
        }
        else {
            this.tabs = this.tabInput;
        }
        this.tabs.forEach(function (tab) { return tab.cacheActive = _this.cacheActive; });
        this.tabs.changes.subscribe(function () {
            _this.setFirstTab();
        });
        this.setFirstTab();
    };
    TabHeaders.prototype.ngOnChanges = function (changes) {
        var _this = this;
        if (this.tabs && changes.cacheActive) {
            this.tabs.forEach(function (tab) { return tab.cacheActive = _this.cacheActive; });
        }
    };
    /**
     * Controls manually focusing tabs.
     */
    TabHeaders.prototype.onTabFocus = function (ref, index) {
        this.currentSelectedTab = index;
        // reset scroll left because we're already handling it
        this.headerContainer.nativeElement.parentElement.scrollLeft = 0;
    };
    TabHeaders.prototype.getSelectedTab = function () {
        var selected = this.tabs.find(function (tab) { return tab.active; });
        if (selected) {
            return selected;
        }
        return { headingIsTemplate: false, heading: "" };
    };
    /**
     * Selects `Tab` 'tab' and moves it into view on the view DOM if it is not already.
     */
    TabHeaders.prototype.selectTab = function (ref, tab, tabIndex) {
        if (tab.disabled) {
            return;
        }
        this.currentSelectedTab = tabIndex;
        this.tabs.forEach(function (_tab) { return _tab.active = false; });
        tab.active = true;
        tab.doSelect();
    };
    TabHeaders.prototype.handleScroll = function () {
        this.changeDetectorRef.markForCheck();
    };
    TabHeaders.prototype.handleOverflowNavClick = function (direction, multiplier) {
        if (multiplier === void 0) { multiplier = 15; }
        var tabList = this.headerContainer.nativeElement;
        var clientWidth = tabList.clientWidth, scrollLeft = tabList.scrollLeft, scrollWidth = tabList.scrollWidth;
        if (direction === 1 && !scrollLeft) {
            tabList.scrollLeft += this.OVERFLOW_BUTTON_OFFSET;
        }
        tabList.scrollLeft += direction * multiplier;
        var leftEdgeReached = direction === -1 && scrollLeft < this.OVERFLOW_BUTTON_OFFSET;
        var rightEdgeReached = direction === 1 &&
            scrollLeft + clientWidth >= scrollWidth - this.OVERFLOW_BUTTON_OFFSET;
        if (leftEdgeReached) {
            this.rightOverflowNavButton.nativeElement.focus();
        }
        if (rightEdgeReached) {
            this.leftOverflowNavButton.nativeElement.focus();
        }
    };
    TabHeaders.prototype.handleOverflowNavMouseDown = function (direction) {
        var _this = this;
        var tabList = this.headerContainer.nativeElement;
        this.overflowNavInterval = setInterval(function () {
            var clientWidth = tabList.clientWidth, scrollLeft = tabList.scrollLeft, scrollWidth = tabList.scrollWidth;
            // clear interval if scroll reaches left or right edge
            var leftEdgeReached = direction === -1 && scrollLeft < _this.OVERFLOW_BUTTON_OFFSET;
            var rightEdgeReached = direction === 1 &&
                scrollLeft + clientWidth >= scrollWidth - _this.OVERFLOW_BUTTON_OFFSET;
            if (leftEdgeReached || rightEdgeReached) {
                clearInterval(_this.overflowNavInterval);
            }
            // account for overflow button appearing and causing tablist width change
            _this.handleOverflowNavClick(direction);
        });
    };
    TabHeaders.prototype.handleOverflowNavMouseUp = function () {
        clearInterval(this.overflowNavInterval);
    };
    /**
     * Determines which `Tab` is initially selected.
     */
    TabHeaders.prototype.setFirstTab = function () {
        var _this = this;
        setTimeout(function () {
            var firstTab = _this.tabs.find(function (tab) { return tab.active; });
            if (!firstTab && _this.tabs.first) {
                firstTab = _this.tabs.first;
                firstTab.active = true;
            }
            if (firstTab) {
                firstTab.doSelect();
            }
        });
    };
    TabHeaders.decorators = [
        { type: Component, args: [{
                    selector: "ibm-tab-headers",
                    template: "\n\t\t<nav\n\t\t\tclass=\"bx--tabs--scrollable\"\n\t\t\t[ngClass]=\"{\n\t\t\t\t'bx--skeleton': skeleton,\n\t\t\t\t'bx--tabs--container bx--tabs--scrollable--container': type === 'container'\n\t\t\t}\"\n\t\t\trole=\"navigation\"\n\t\t\t[attr.aria-label]=\"ariaLabel\"\n\t\t\t[attr.aria-labelledby]=\"ariaLabelledby\">\n\t\t\t<button\n\t\t\t\t#leftOverflowNavButton\n\t\t\t\ttype=\"button\"\n\t\t\t\t[title]=\"translations.PREVIOUS\"\n\t\t\t\t[ngClass]=\"{\n\t\t\t\t\t'bx--tab--overflow-nav-button': hasHorizontalOverflow,\n\t\t\t\t\t'bx--tab--overflow-nav-button--hidden': leftOverflowNavButtonHidden\n\t\t\t\t}\"\n\t\t\t\t(click)=\"handleOverflowNavClick(-1)\"\n\t\t\t\t(mousedown)=\"handleOverflowNavMouseDown(-1)\"\n\t\t\t\t(mouseup)=\"handleOverflowNavMouseUp()\">\n\t\t\t\t<svg\n\t\t\t\t\tfocusable=\"false\"\n\t\t\t\t\tpreserveAspectRatio=\"xMidYMid meet\"\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\twidth=\"16\"\n\t\t\t\t\theight=\"16\"\n\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\taria-hidden=\"true\">\n\t\t\t\t\t<path d=\"M5 8L10 3 10.7 3.7 6.4 8 10.7 12.3 10 13z\"></path>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t\t<div *ngIf=\"!leftOverflowNavButtonHidden\" class=\"bx--tabs__overflow-indicator--left\"></div>\n\t\t\t<ul\n\t\t\t\t#tabList\n\t\t\t\tclass=\"bx--tabs--scrollable__nav\"\n\t\t\t\trole=\"tablist\"\n\t\t\t\t(scroll)=\"handleScroll()\">\n\t\t\t\t<li role=\"presentation\">\n\t\t\t\t\t<ng-container *ngIf=\"contentBefore\" [ngTemplateOutlet]=\"contentBefore\"></ng-container>\n\t\t\t\t</li>\n\t\t\t\t<li\n\t\t\t\t\t*ngFor=\"let tab of tabs; let i = index;\"\n\t\t\t\t\t[ngClass]=\"{\n\t\t\t\t\t\t'bx--tabs__nav-item--selected bx--tabs--scrollable__nav-item--selected': tab.active,\n\t\t\t\t\t\t'bx--tabs__nav-item--disabled bx--tabs--scrollable__nav-item--disabled': tab.disabled\n\t\t\t\t\t}\"\n\t\t\t\t\tclass=\"bx--tabs--scrollable__nav-item\"\n\t\t\t\t\trole=\"presentation\"\n\t\t\t\t\t(click)=\"selectTab(tabItem, tab, i)\">\n\t\t\t\t\t<button\n\t\t\t\t\t\t#tabItem\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t[attr.aria-selected]=\"tab.active\"\n\t\t\t\t\t\t[attr.tabindex]=\"(tab.active?0:-1)\"\n\t\t\t\t\t\t[attr.aria-controls]=\"tab.id\"\n\t\t\t\t\t\t[attr.aria-disabled]=\"tab.disabled\"\n\t\t\t\t\t\t(focus)=\"onTabFocus(tabItem, i)\"\n\t\t\t\t\t\t(click)=\"$event.preventDefault()\"\n\t\t\t\t\t\tdraggable=\"false\"\n\t\t\t\t\t\tid=\"{{tab.id}}-header\"\n\t\t\t\t\t\tclass=\"bx--tabs--scrollable__nav-link\"\n\t\t\t\t\t\t[title]=\"tab.title ? tab.title : tab.heading\"\n\t\t\t\t\t\thref=\"#\"\n\t\t\t\t\t\trole=\"tab\">\n\t\t\t\t\t\t<ng-container *ngIf=\"!tab.headingIsTemplate\">\n\t\t\t\t\t\t\t{{ tab.heading }}\n\t\t\t\t\t\t</ng-container>\n\t\t\t\t\t\t<ng-template\n\t\t\t\t\t\t\t*ngIf=\"tab.headingIsTemplate\"\n\t\t\t\t\t\t\t[ngTemplateOutlet]=\"tab.heading\"\n\t\t\t\t\t\t\t[ngTemplateOutletContext]=\"{$implicit: tab.context}\">\n\t\t\t\t\t\t</ng-template>\n\t\t\t\t\t</button>\n\t\t\t\t</li>\n\t\t\t\t<li role=\"presentation\">\n\t\t\t\t\t<ng-container *ngIf=\"contentAfter\" [ngTemplateOutlet]=\"contentAfter\"></ng-container>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t\t<div *ngIf=\"!rightOverflowNavButtonHidden\" class=\"bx--tabs__overflow-indicator--right\"></div>\n\t\t\t<button\n\t\t\t\t#rightOverflowNavButton\n\t\t\t\ttype=\"button\"\n\t\t\t\t[title]=\"translations.NEXT\"\n\t\t\t\t[ngClass]=\"{\n\t\t\t\t\t'bx--tab--overflow-nav-button': hasHorizontalOverflow,\n\t\t\t\t\t'bx--tab--overflow-nav-button--hidden': rightOverflowNavButtonHidden\n\t\t\t\t}\"\n\t\t\t\t(click)=\"handleOverflowNavClick(1)\"\n\t\t\t\t(mousedown)=\"handleOverflowNavMouseDown(1)\"\n\t\t\t\t(mouseup)=\"handleOverflowNavMouseUp()\">\n\t\t\t\t<svg\n\t\t\t\t\tfocusable=\"false\"\n\t\t\t\t\tpreserveAspectRatio=\"xMidYMid meet\"\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\twidth=\"16\"\n\t\t\t\t\theight=\"16\"\n\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\taria-hidden=\"true\">\n\t\t\t\t\t<path d=\"M11 8L6 13 5.3 12.3 9.6 8 5.3 3.7 6 3z\"></path>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t</nav>\n\t"
                }] }
    ];
    /** @nocollapse */
    TabHeaders.ctorParameters = function () { return [
        { type: ElementRef },
        { type: ChangeDetectorRef },
        { type: EventService },
        { type: I18n }
    ]; };
    TabHeaders.propDecorators = {
        tabInput: [{ type: Input, args: ["tabs",] }],
        cacheActive: [{ type: Input }],
        followFocus: [{ type: Input }],
        skeleton: [{ type: Input }],
        ariaLabel: [{ type: Input }],
        ariaLabelledby: [{ type: Input }],
        contentBefore: [{ type: Input }],
        contentAfter: [{ type: Input }],
        type: [{ type: Input }],
        translations: [{ type: Input }],
        headerContainer: [{ type: ViewChild, args: ["tabList", { static: true },] }],
        rightOverflowNavButton: [{ type: ViewChild, args: ["rightOverflowNavButton", { static: true },] }],
        leftOverflowNavButton: [{ type: ViewChild, args: ["leftOverflowNavButton", { static: true },] }],
        tabQuery: [{ type: ContentChildren, args: [Tab,] }],
        allTabHeaders: [{ type: ViewChildren, args: ["tabItem",] }],
        keyboardInput: [{ type: HostListener, args: ["keydown", ["$event"],] }]
    };
    return TabHeaders;
}());
export { TabHeaders };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFiLWhlYWRlcnMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vY2FyYm9uLWNvbXBvbmVudHMtYW5ndWxhci90YWJzLyIsInNvdXJjZXMiOlsidGFiLWhlYWRlcnMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTixTQUFTLEVBQ1QsU0FBUyxFQUNULEtBQUssRUFDTCxZQUFZLEVBQ1osU0FBUyxFQUNULGVBQWUsRUFFZixZQUFZLEVBQ1osVUFBVSxFQUNWLFdBQVcsRUFJWCxpQkFBaUIsRUFDakIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQy9ELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUN0RCxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFdEM7OztHQUdHO0FBQ0g7SUFxTUMsb0JBQ1csVUFBc0IsRUFDdEIsaUJBQW9DLEVBQ3BDLFlBQTBCLEVBQzFCLElBQVU7UUFIVixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIsU0FBSSxHQUFKLElBQUksQ0FBTTtRQXBGckI7OztXQUdHO1FBQ00sZ0JBQVcsR0FBRyxLQUFLLENBQUM7UUFLN0I7O1dBRUc7UUFDTSxhQUFRLEdBQUcsS0FBSyxDQUFDO1FBYWpCLFNBQUksR0FBNEIsU0FBUyxDQUFDO1FBRTFDLGlCQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxVQUFVLENBQUM7UUFtQm5EOztXQUVHO1FBQ0ksb0JBQWUsR0FBRyxDQUFDLENBQUM7UUEwQjNCLGdDQUFnQztRQUNoQywyQkFBc0IsR0FBRyxFQUFFLENBQUM7SUFTeEIsQ0FBQztJQTFCTCxzQkFBVyw2Q0FBcUI7YUFBaEM7WUFDQyxJQUFNLE9B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SyxTQUFDLE1BQU07OEJBS1osS0FBSzs4QkFJTCxLQUFLOzJCQUlMLEtBQUs7NEJBSUwsS0FBSztpQ0FJTCxLQUFLO2dDQUVMLEtBQUs7K0JBQ0wsS0FBSzt1QkFFTCxLQUFLOytCQUVMLEtBQUs7a0NBTUwsU0FBUyxTQUFDLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7eUNBRXJDLFNBQVMsU0FBQyx3QkFBd0IsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7d0NBRXBELFNBQVMsU0FBQyx1QkFBdUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7MkJBSW5ELGVBQWUsU0FBQyxHQUFHO2dDQVluQixZQUFZLFNBQUMsU0FBUztnQ0FzQ3RCLFlBQVksU0FBQyxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUM7O0lBdUxwQyxpQkFBQztDQUFBLEFBdllELElBdVlDO1NBelJZLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuXHRDb21wb25lbnQsXG5cdFF1ZXJ5TGlzdCxcblx0SW5wdXQsXG5cdEhvc3RMaXN0ZW5lcixcblx0Vmlld0NoaWxkLFxuXHRDb250ZW50Q2hpbGRyZW4sXG5cdEFmdGVyQ29udGVudEluaXQsXG5cdFZpZXdDaGlsZHJlbixcblx0RWxlbWVudFJlZixcblx0VGVtcGxhdGVSZWYsXG5cdE9uQ2hhbmdlcyxcblx0U2ltcGxlQ2hhbmdlcyxcblx0T25Jbml0LFxuXHRDaGFuZ2VEZXRlY3RvclJlZlxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgRXZlbnRTZXJ2aWNlIH0gZnJvbSBcImNhcmJvbi1jb21wb25lbnRzLWFuZ3VsYXIvdXRpbHNcIjtcbmltcG9ydCB7IEkxOG4gfSBmcm9tIFwiY2FyYm9uLWNvbXBvbmVudHMtYW5ndWxhci9pMThuXCI7XG5pbXBvcnQgeyBUYWIgfSBmcm9tIFwiLi90YWIuY29tcG9uZW50XCI7XG5cbi8qKlxuICogVGhlIGBUYWJIZWFkZXJzYCBjb21wb25lbnQgY29udGFpbnMgdGhlIGBUYWJgIGl0ZW1zIGFuZCBjb250cm9scyBzY3JvbGwgZnVuY3Rpb25hbGl0eVxuICogaWYgY29udGVudCBoYXMgb3ZlcmZsb3cuXG4gKi9cbkBDb21wb25lbnQoe1xuXHRzZWxlY3RvcjogXCJpYm0tdGFiLWhlYWRlcnNcIixcblx0dGVtcGxhdGU6IGBcblx0XHQ8bmF2XG5cdFx0XHRjbGFzcz1cImJ4LS10YWJzLS1zY3JvbGxhYmxlXCJcblx0XHRcdFtuZ0NsYXNzXT1cIntcblx0XHRcdFx0J2J4LS1za2VsZXRvbic6IHNrZWxldG9uLFxuXHRcdFx0XHQnYngtLXRhYnMtLWNvbnRhaW5lciBieC0tdGFicy0tc2Nyb2xsYWJsZS0tY29udGFpbmVyJzogdHlwZSA9PT0gJ2NvbnRhaW5lcidcblx0XHRcdH1cIlxuXHRcdFx0cm9sZT1cIm5hdmlnYXRpb25cIlxuXHRcdFx0W2F0dHIuYXJpYS1sYWJlbF09XCJhcmlhTGFiZWxcIlxuXHRcdFx0W2F0dHIuYXJpYS1sYWJlbGxlZGJ5XT1cImFyaWFMYWJlbGxlZGJ5XCI+XG5cdFx0XHQ8YnV0dG9uXG5cdFx0XHRcdCNsZWZ0T3ZlcmZsb3dOYXZCdXR0b25cblx0XHRcdFx0dHlwZT1cImJ1dHRvblwiXG5cdFx0XHRcdFt0aXRsZV09XCJ0cmFuc2xhdGlvbnMuUFJFVklPVVNcIlxuXHRcdFx0XHRbbmdDbGFzc109XCJ7XG5cdFx0XHRcdFx0J2J4LS10YWItLW92ZXJmbG93LW5hdi1idXR0b24nOiBoYXNIb3Jpem9udGFsT3ZlcmZsb3csXG5cdFx0XHRcdFx0J2J4LS10YWItLW92ZXJmbG93LW5hdi1idXR0b24tLWhpZGRlbic6IGxlZnRPdmVyZmxvd05hdkJ1dHRvbkhpZGRlblxuXHRcdFx0XHR9XCJcblx0XHRcdFx0KGNsaWNrKT1cImhhbmRsZU92ZXJmbG93TmF2Q2xpY2soLTEpXCJcblx0XHRcdFx0KG1vdXNlZG93bik9XCJoYW5kbGVPdmVyZmxvd05hdk1vdXNlRG93bigtMSlcIlxuXHRcdFx0XHQobW91c2V1cCk9XCJoYW5kbGVPdmVyZmxvd05hdk1vdXNlVXAoKVwiPlxuXHRcdFx0XHQ8c3ZnXG5cdFx0XHRcdFx0Zm9jdXNhYmxlPVwiZmFsc2VcIlxuXHRcdFx0XHRcdHByZXNlcnZlQXNwZWN0UmF0aW89XCJ4TWlkWU1pZCBtZWV0XCJcblx0XHRcdFx0XHR4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCJcblx0XHRcdFx0XHRmaWxsPVwiY3VycmVudENvbG9yXCJcblx0XHRcdFx0XHR3aWR0aD1cIjE2XCJcblx0XHRcdFx0XHRoZWlnaHQ9XCIxNlwiXG5cdFx0XHRcdFx0dmlld0JveD1cIjAgMCAxNiAxNlwiXG5cdFx0XHRcdFx0YXJpYS1oaWRkZW49XCJ0cnVlXCI+XG5cdFx0XHRcdFx0PHBhdGggZD1cIk01IDhMMTAgMyAxMC43IDMuNyA2LjQgOCAxMC43IDEyLjMgMTAgMTN6XCI+PC9wYXRoPlxuXHRcdFx0XHQ8L3N2Zz5cblx0XHRcdDwvYnV0dG9uPlxuXHRcdFx0PGRpdiAqbmdJZj1cIiFsZWZ0T3ZlcmZsb3dOYXZCdXR0b25IaWRkZW5cIiBjbGFzcz1cImJ4LS10YWJzX19vdmVyZmxvdy1pbmRpY2F0b3ItLWxlZnRcIj48L2Rpdj5cblx0XHRcdDx1bFxuXHRcdFx0XHQjdGFiTGlzdFxuXHRcdFx0XHRjbGFzcz1cImJ4LS10YWJzLS1zY3JvbGxhYmxlX19uYXZcIlxuXHRcdFx0XHRyb2xlPVwidGFibGlzdFwiXG5cdFx0XHRcdChzY3JvbGwpPVwiaGFuZGxlU2Nyb2xsKClcIj5cblx0XHRcdFx0PGxpIHJvbGU9XCJwcmVzZW50YXRpb25cIj5cblx0XHRcdFx0XHQ8bmctY29udGFpbmVyICpuZ0lmPVwiY29udGVudEJlZm9yZVwiIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImNvbnRlbnRCZWZvcmVcIj48L25nLWNvbnRhaW5lcj5cblx0XHRcdFx0PC9saT5cblx0XHRcdFx0PGxpXG5cdFx0XHRcdFx0Km5nRm9yPVwibGV0IHRhYiBvZiB0YWJzOyBsZXQgaSA9IGluZGV4O1wiXG5cdFx0XHRcdFx0W25nQ2xhc3NdPVwie1xuXHRcdFx0XHRcdFx0J2J4LS10YWJzX19uYXYtaXRlbS0tc2VsZWN0ZWQgYngtLXRhYnMtLXNjcm9sbGFibGVfX25hdi1pdGVtLS1zZWxlY3RlZCc6IHRhYi5hY3RpdmUsXG5cdFx0XHRcdFx0XHQnYngtLXRhYnNfX25hdi1pdGVtLS1kaXNhYmxlZCBieC0tdGFicy0tc2Nyb2xsYWJsZV9fbmF2LWl0ZW0tLWRpc2FibGVkJzogdGFiLmRpc2FibGVkXG5cdFx0XHRcdFx0fVwiXG5cdFx0XHRcdFx0Y2xhc3M9XCJieC0tdGFicy0tc2Nyb2xsYWJsZV9fbmF2LWl0ZW1cIlxuXHRcdFx0XHRcdHJvbGU9XCJwcmVzZW50YXRpb25cIlxuXHRcdFx0XHRcdChjbGljayk9XCJzZWxlY3RUYWIodGFiSXRlbSwgdGFiLCBpKVwiPlxuXHRcdFx0XHRcdDxidXR0b25cblx0XHRcdFx0XHRcdCN0YWJJdGVtXG5cdFx0XHRcdFx0XHR0eXBlPVwiYnV0dG9uXCJcblx0XHRcdFx0XHRcdFthdHRyLmFyaWEtc2VsZWN0ZWRdPVwidGFiLmFjdGl2ZVwiXG5cdFx0XHRcdFx0XHRbYXR0ci50YWJpbmRleF09XCIodGFiLmFjdGl2ZT8wOi0xKVwiXG5cdFx0XHRcdFx0XHRbYXR0ci5hcmlhLWNvbnRyb2xzXT1cInRhYi5pZFwiXG5cdFx0XHRcdFx0XHRbYXR0ci5hcmlhLWRpc2FibGVkXT1cInRhYi5kaXNhYmxlZFwiXG5cdFx0XHRcdFx0XHQoZm9jdXMpPVwib25UYWJGb2N1cyh0YWJJdGVtLCBpKVwiXG5cdFx0XHRcdFx0XHQoY2xpY2spPVwiJGV2ZW50LnByZXZlbnREZWZhdWx0KClcIlxuXHRcdFx0XHRcdFx0ZHJhZ2dhYmxlPVwiZmFsc2VcIlxuXHRcdFx0XHRcdFx0aWQ9XCJ7e3RhYi5pZH19LWhlYWRlclwiXG5cdFx0XHRcdFx0XHRjbGFzcz1cImJ4LS10YWJzLS1zY3JvbGxhYmxlX19uYXYtbGlua1wiXG5cdFx0XHRcdFx0XHRbdGl0bGVdPVwidGFiLnRpdGxlID8gdGFiLnRpdGxlIDogdGFiLmhlYWRpbmdcIlxuXHRcdFx0XHRcdFx0aHJlZj1cIiNcIlxuXHRcdFx0XHRcdFx0cm9sZT1cInRhYlwiPlxuXHRcdFx0XHRcdFx0PG5nLWNvbnRhaW5lciAqbmdJZj1cIiF0YWIuaGVhZGluZ0lzVGVtcGxhdGVcIj5cblx0XHRcdFx0XHRcdFx0e3sgdGFiLmhlYWRpbmcgfX1cblx0XHRcdFx0XHRcdDwvbmctY29udGFpbmVyPlxuXHRcdFx0XHRcdFx0PG5nLXRlbXBsYXRlXG5cdFx0XHRcdFx0XHRcdCpuZ0lmPVwidGFiLmhlYWRpbmdJc1RlbXBsYXRlXCJcblx0XHRcdFx0XHRcdFx0W25nVGVtcGxhdGVPdXRsZXRdPVwidGFiLmhlYWRpbmdcIlxuXHRcdFx0XHRcdFx0XHRbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyRpbXBsaWNpdDogdGFiLmNvbnRleHR9XCI+XG5cdFx0XHRcdFx0XHQ8L25nLXRlbXBsYXRlPlxuXHRcdFx0XHRcdDwvYnV0dG9uPlxuXHRcdFx0XHQ8L2xpPlxuXHRcdFx0XHQ8bGkgcm9sZT1cInByZXNlbnRhdGlvblwiPlxuXHRcdFx0XHRcdDxuZy1jb250YWluZXIgKm5nSWY9XCJjb250ZW50QWZ0ZXJcIiBbbmdUZW1wbGF0ZU91dGxldF09XCJjb250ZW50QWZ0ZXJcIj48L25nLWNvbnRhaW5lcj5cblx0XHRcdFx0PC9saT5cblx0XHRcdDwvdWw+XG5cdFx0XHQ8ZGl2ICpuZ0lmPVwiIXJpZ2h0T3ZlcmZsb3dOYXZCdXR0b25IaWRkZW5cIiBjbGFzcz1cImJ4LS10YWJzX19vdmVyZmxvdy1pbmRpY2F0b3ItLXJpZ2h0XCI+PC9kaXY+XG5cdFx0XHQ8YnV0dG9uXG5cdFx0XHRcdCNyaWdodE92ZXJmbG93TmF2QnV0dG9uXG5cdFx0XHRcdHR5cGU9XCJidXR0b25cIlxuXHRcdFx0XHRbdGl0bGVdPVwidHJhbnNsYXRpb25zLk5FWFRcIlxuXHRcdFx0XHRbbmdDbGFzc109XCJ7XG5cdFx0XHRcdFx0J2J4LS10YWItLW92ZXJmbG93LW5hdi1idXR0b24nOiBoYXNIb3Jpem9udGFsT3ZlcmZsb3csXG5cdFx0XHRcdFx0J2J4LS10YWItLW92ZXJmbG93LW5hdi1idXR0b24tLWhpZGRlbic6IHJpZ2h0T3ZlcmZsb3dOYXZCdXR0b25IaWRkZW5cblx0XHRcdFx0fVwiXG5cdFx0XHRcdChjbGljayk9XCJoYW5kbGVPdmVyZmxvd05hdkNsaWNrKDEpXCJcblx0XHRcdFx0KG1vdXNlZG93bik9XCJoYW5kbGVPdmVyZmxvd05hdk1vdXNlRG93bigxKVwiXG5cdFx0XHRcdChtb3VzZXVwKT1cImhhbmRsZU92ZXJmbG93TmF2TW91c2VVcCgpXCI+XG5cdFx0XHRcdDxzdmdcblx0XHRcdFx0XHRmb2N1c2FibGU9XCJmYWxzZVwiXG5cdFx0XHRcdFx0cHJlc2VydmVBc3BlY3RSYXRpbz1cInhNaWRZTWlkIG1lZXRcIlxuXHRcdFx0XHRcdHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIlxuXHRcdFx0XHRcdGZpbGw9XCJjdXJyZW50Q29sb3JcIlxuXHRcdFx0XHRcdHdpZHRoPVwiMTZcIlxuXHRcdFx0XHRcdGhlaWdodD1cIjE2XCJcblx0XHRcdFx0XHR2aWV3Qm94PVwiMCAwIDE2IDE2XCJcblx0XHRcdFx0XHRhcmlhLWhpZGRlbj1cInRydWVcIj5cblx0XHRcdFx0XHQ8cGF0aCBkPVwiTTExIDhMNiAxMyA1LjMgMTIuMyA5LjYgOCA1LjMgMy43IDYgM3pcIj48L3BhdGg+XG5cdFx0XHRcdDwvc3ZnPlxuXHRcdFx0PC9idXR0b24+XG5cdFx0PC9uYXY+XG5cdGBcbn0pXG5cbmV4cG9ydCBjbGFzcyBUYWJIZWFkZXJzIGltcGxlbWVudHMgQWZ0ZXJDb250ZW50SW5pdCwgT25DaGFuZ2VzLCBPbkluaXQge1xuXHQvKipcblx0ICogTGlzdCBvZiBgVGFiYCBjb21wb25lbnRzLlxuXHQgKi9cblx0Ly8gZGlzYWJsZSB0aGUgbmV4dCBsaW5lIGJlY2F1c2Ugd2UgbmVlZCB0byByZW5hbWUgdGhlIGlucHV0XG5cdC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZVxuXHRASW5wdXQoXCJ0YWJzXCIpIHRhYklucHV0OiBRdWVyeUxpc3Q8VGFiPjtcblx0LyoqXG5cdCAqIFNldCB0byAndHJ1ZScgdG8gaGF2ZSBgVGFiYCBpdGVtcyBjYWNoZWQgYW5kIG5vdCByZWxvYWRlZCBvbiB0YWIgc3dpdGNoaW5nLlxuXHQgKiBEdXBsaWNhdGUgZnJvbSBgbi10YWJzYCB0byBzdXBwb3J0IHN0YW5kYWxvbmUgaGVhZGVyc1xuXHQgKi9cblx0QElucHV0KCkgY2FjaGVBY3RpdmUgPSBmYWxzZTtcblx0LyoqXG5cdCAqIFNldCB0byAndHJ1ZScgdG8gaGF2ZSB0YWJzIGF1dG9tYXRpY2FsbHkgYWN0aXZhdGVkIGFuZCBoYXZlIHRoZWlyIGNvbnRlbnQgZGlzcGxheWVkIHdoZW4gdGhleSByZWNlaXZlIGZvY3VzLlxuXHQgKi9cblx0QElucHV0KCkgZm9sbG93Rm9jdXM6IGJvb2xlYW47XG5cdC8qKlxuXHQgKiBTZXQgdG8gYHRydWVgIHRvIHB1dCB0YWJzIGluIGEgbG9hZGluZyBzdGF0ZS5cblx0ICovXG5cdEBJbnB1dCgpIHNrZWxldG9uID0gZmFsc2U7XG5cdC8qKlxuXHQgKiBTZXRzIHRoZSBhcmlhIGxhYmVsIG9uIHRoZSBuYXYgZWxlbWVudC5cblx0ICovXG5cdEBJbnB1dCgpIGFyaWFMYWJlbDogc3RyaW5nO1xuXHQvKipcblx0ICogU2V0cyB0aGUgYXJpYSBsYWJlbGxlZGJ5IG9uIHRoZSBuYXYgZWxlbWVudC5cblx0ICovXG5cdEBJbnB1dCgpIGFyaWFMYWJlbGxlZGJ5OiBzdHJpbmc7XG5cblx0QElucHV0KCkgY29udGVudEJlZm9yZTogVGVtcGxhdGVSZWY8YW55Pjtcblx0QElucHV0KCkgY29udGVudEFmdGVyOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG5cdEBJbnB1dCgpIHR5cGU6IFwiZGVmYXVsdFwiIHwgXCJjb250YWluZXJcIiA9IFwiZGVmYXVsdFwiO1xuXG5cdEBJbnB1dCgpIHRyYW5zbGF0aW9ucyA9IHRoaXMuaTE4bi5nZXQoKS5QQUdJTkFUSU9OO1xuXG5cdC8qKlxuXHQgKiBHZXRzIHRoZSBVbm9yZGVyZWQgTGlzdCBlbGVtZW50IHRoYXQgaG9sZHMgdGhlIGBUYWJgIGhlYWRpbmdzIGZyb20gdGhlIHZpZXcgRE9NLlxuXHQgKi9cblx0Ly8gQHRzLWlnbm9yZVxuXHRAVmlld0NoaWxkKFwidGFiTGlzdFwiLCB7IHN0YXRpYzogdHJ1ZSB9KSBoZWFkZXJDb250YWluZXI7XG5cdC8vIEB0cy1pZ25vcmVcblx0QFZpZXdDaGlsZChcInJpZ2h0T3ZlcmZsb3dOYXZCdXR0b25cIiwgeyBzdGF0aWM6IHRydWUgfSkgcmlnaHRPdmVyZmxvd05hdkJ1dHRvbjtcblx0Ly8gQHRzLWlnbm9yZVxuXHRAVmlld0NoaWxkKFwibGVmdE92ZXJmbG93TmF2QnV0dG9uXCIsIHsgc3RhdGljOiB0cnVlIH0pIGxlZnRPdmVyZmxvd05hdkJ1dHRvbjtcblx0LyoqXG5cdCAqIENvbnRlbnRDaGlsZCBvZiBhbGwgdGhlIG4tdGFic1xuXHQgKi9cblx0QENvbnRlbnRDaGlsZHJlbihUYWIpIHRhYlF1ZXJ5OiBRdWVyeUxpc3Q8VGFiPjtcblx0LyoqXG5cdCAqIHNldCB0byB0YWJRdWVyeSBpZiB0YWJJbnB1dCBpcyBlbXB0eVxuXHQgKi9cblx0cHVibGljIHRhYnM6IFF1ZXJ5TGlzdDxUYWI+O1xuXHQvKipcblx0ICogVGhlIGluZGV4IG9mIHRoZSBmaXJzdCB2aXNpYmxlIHRhYi5cblx0ICovXG5cdHB1YmxpYyBmaXJzdFZpc2libGVUYWIgPSAwO1xuXHQvKipcblx0ICogVGhlIERPTSBlbGVtZW50IGNvbnRhaW5pbmcgdGhlIGBUYWJgIGhlYWRpbmdzIGRpc3BsYXllZC5cblx0ICovXG5cdEBWaWV3Q2hpbGRyZW4oXCJ0YWJJdGVtXCIpIGFsbFRhYkhlYWRlcnM6IFF1ZXJ5TGlzdDxFbGVtZW50UmVmPjtcblx0LyoqXG5cdCAqIENvbnRyb2xzIHRoZSBtYW51YWwgZm9jdXNpbmcgZG9uZSBieSB0YWJiaW5nIHRocm91Z2ggaGVhZGluZ3MuXG5cdCAqL1xuXHRwdWJsaWMgY3VycmVudFNlbGVjdGVkVGFiOiBudW1iZXI7XG5cblx0cHVibGljIGdldCBoYXNIb3Jpem9udGFsT3ZlcmZsb3coKSB7XG5cdFx0Y29uc3QgdGFiTGlzdCA9IHRoaXMuaGVhZGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQ7XG5cdFx0cmV0dXJuIHRhYkxpc3Quc2Nyb2xsV2lkdGggPiB0YWJMaXN0LmNsaWVudFdpZHRoO1xuXHR9XG5cblx0cHVibGljIGdldCBsZWZ0T3ZlcmZsb3dOYXZCdXR0b25IaWRkZW4oKSB7XG5cdFx0Y29uc3QgdGFiTGlzdCA9IHRoaXMuaGVhZGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQ7XG5cdFx0cmV0dXJuICF0aGlzLmhhc0hvcml6b250YWxPdmVyZmxvdyB8fCAhdGFiTGlzdC5zY3JvbGxMZWZ0O1xuXHR9XG5cblx0cHVibGljIGdldCByaWdodE92ZXJmbG93TmF2QnV0dG9uSGlkZGVuKCkge1xuXHRcdGNvbnN0IHRhYkxpc3QgPSB0aGlzLmhlYWRlckNvbnRhaW5lci5uYXRpdmVFbGVtZW50O1xuXHRcdHJldHVybiAhdGhpcy5oYXNIb3Jpem9udGFsT3ZlcmZsb3cgfHxcblx0XHRcdCh0YWJMaXN0LnNjcm9sbExlZnQgKyB0YWJMaXN0LmNsaWVudFdpZHRoKSA9PT0gdGFiTGlzdC5zY3JvbGxXaWR0aDtcblx0fVxuXG5cdC8vIHdpZHRoIG9mIHRoZSBvdmVyZmxvdyBidXR0b25zXG5cdE9WRVJGTE9XX0JVVFRPTl9PRkZTRVQgPSA0MDtcblxuXHRwcml2YXRlIG92ZXJmbG93TmF2SW50ZXJ2YWw7XG5cblx0Y29uc3RydWN0b3IoXG5cdFx0cHJvdGVjdGVkIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXG5cdFx0cHJvdGVjdGVkIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcblx0XHRwcm90ZWN0ZWQgZXZlbnRTZXJ2aWNlOiBFdmVudFNlcnZpY2UsXG5cdFx0cHJvdGVjdGVkIGkxOG46IEkxOG5cblx0KSB7IH1cblxuXHQvLyBrZXlib2FyZCBhY2Nlc3NpYmlsaXR5XG5cdC8qKlxuXHQgKiBDb250cm9scyB0aGUga2V5ZG93biBldmVudHMgdXNlZCBmb3IgdGFiYmluZyB0aHJvdWdoIHRoZSBoZWFkaW5ncy5cblx0ICovXG5cdEBIb3N0TGlzdGVuZXIoXCJrZXlkb3duXCIsIFtcIiRldmVudFwiXSlcblx0a2V5Ym9hcmRJbnB1dChldmVudCkge1xuXHRcdGxldCB0YWJzQXJyYXkgPSBBcnJheS5mcm9tPGFueT4odGhpcy50YWJzKTtcblxuXHRcdC8vIFwiUmlnaHRcIiBpcyBhbiBpZTExIHNwZWNpZmljIHZhbHVlXG5cdFx0aWYgKGV2ZW50LmtleSA9PT0gXCJSaWdodFwiIHx8IGV2ZW50LmtleSA9PT0gXCJBcnJvd1JpZ2h0XCIpIHtcblx0XHRcdGlmICh0aGlzLmN1cnJlbnRTZWxlY3RlZFRhYiA8IHRoaXMuYWxsVGFiSGVhZGVycy5sZW5ndGggLSAxKSB7XG5cdFx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdGlmICh0aGlzLmZvbGxvd0ZvY3VzKSB7XG5cdFx0XHRcdFx0dGhpcy5zZWxlY3RUYWIoZXZlbnQudGFyZ2V0LCB0YWJzQXJyYXlbdGhpcy5jdXJyZW50U2VsZWN0ZWRUYWIgKyAxXSwgdGhpcy5jdXJyZW50U2VsZWN0ZWRUYWIpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHRoaXMuYWxsVGFiSGVhZGVycy50b0FycmF5KClbdGhpcy5jdXJyZW50U2VsZWN0ZWRUYWIgKyAxXS5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRpZiAodGhpcy5mb2xsb3dGb2N1cykge1xuXHRcdFx0XHRcdHRoaXMuc2VsZWN0VGFiKGV2ZW50LnRhcmdldCwgdGFic0FycmF5WzBdLCAwKTtcblx0XHRcdFx0fVxuXHRcdFx0XHR0aGlzLmFsbFRhYkhlYWRlcnMuZmlyc3QubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIFwiTGVmdFwiIGlzIGFuIGllMTEgc3BlY2lmaWMgdmFsdWVcblx0XHRpZiAoZXZlbnQua2V5ID09PSBcIkxlZnRcIiB8fCBldmVudC5rZXkgPT09IFwiQXJyb3dMZWZ0XCIpIHtcblx0XHRcdGlmICh0aGlzLmN1cnJlbnRTZWxlY3RlZFRhYiA+IDApIHtcblx0XHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0aWYgKHRoaXMuZm9sbG93Rm9jdXMpIHtcblx0XHRcdFx0XHR0aGlzLnNlbGVjdFRhYihldmVudC50YXJnZXQsIHRhYnNBcnJheVt0aGlzLmN1cnJlbnRTZWxlY3RlZFRhYiAtIDFdLCB0aGlzLmN1cnJlbnRTZWxlY3RlZFRhYik7XG5cdFx0XHRcdH1cblx0XHRcdFx0dGhpcy5hbGxUYWJIZWFkZXJzLnRvQXJyYXkoKVt0aGlzLmN1cnJlbnRTZWxlY3RlZFRhYiAtIDFdLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdGlmICh0aGlzLmZvbGxvd0ZvY3VzKSB7XG5cdFx0XHRcdFx0dGhpcy5zZWxlY3RUYWIoZXZlbnQudGFyZ2V0LCB0YWJzQXJyYXlbdGhpcy5hbGxUYWJIZWFkZXJzLmxlbmd0aCAtIDFdLCB0aGlzLmFsbFRhYkhlYWRlcnMubGVuZ3RoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHR0aGlzLmFsbFRhYkhlYWRlcnMudG9BcnJheSgpW3RoaXMuYWxsVGFiSGVhZGVycy5sZW5ndGggLSAxXS5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKGV2ZW50LmtleSA9PT0gXCJIb21lXCIpIHtcblx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRpZiAodGhpcy5mb2xsb3dGb2N1cykge1xuXHRcdFx0XHR0aGlzLnNlbGVjdFRhYihldmVudC50YXJnZXQsIHRhYnNBcnJheVswXSwgMCk7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLmFsbFRhYkhlYWRlcnMudG9BcnJheSgpWzBdLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcblx0XHR9XG5cblx0XHRpZiAoZXZlbnQua2V5ID09PSBcIkVuZFwiKSB7XG5cdFx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0aWYgKHRoaXMuZm9sbG93Rm9jdXMpIHtcblx0XHRcdFx0dGhpcy5zZWxlY3RUYWIoZXZlbnQudGFyZ2V0LCB0YWJzQXJyYXlbdGhpcy5hbGxUYWJIZWFkZXJzLmxlbmd0aCAtIDFdLCB0aGlzLmFsbFRhYkhlYWRlcnMubGVuZ3RoKTtcblx0XHRcdH1cblx0XHRcdHRoaXMuYWxsVGFiSGVhZGVycy50b0FycmF5KClbdGhpcy5hbGxUYWJIZWFkZXJzLmxlbmd0aCAtIDFdLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcblx0XHR9XG5cblx0XHQvLyBgXCJTcGFjZWJhclwiYCBpcyBJRTExIHNwZWNpZmljIHZhbHVlXG5cdFx0aWYgKChldmVudC5rZXkgPT09IFwiIFwiIHx8IGV2ZW50LmtleSA9PT0gXCJTcGFjZWJhclwiKSAmJiAhdGhpcy5mb2xsb3dGb2N1cykge1xuXHRcdFx0dGhpcy5zZWxlY3RUYWIoZXZlbnQudGFyZ2V0LCB0YWJzQXJyYXlbdGhpcy5jdXJyZW50U2VsZWN0ZWRUYWJdLCB0aGlzLmN1cnJlbnRTZWxlY3RlZFRhYik7XG5cdFx0fVxuXHR9XG5cblx0bmdPbkluaXQoKSB7XG5cdFx0dGhpcy5ldmVudFNlcnZpY2Uub24od2luZG93IGFzIGFueSwgXCJyZXNpemVcIiwgKCkgPT4gdGhpcy5oYW5kbGVTY3JvbGwoKSk7XG5cdH1cblxuXHRuZ0FmdGVyQ29udGVudEluaXQoKSB7XG5cdFx0aWYgKCF0aGlzLnRhYklucHV0KSB7XG5cdFx0XHR0aGlzLnRhYnMgPSB0aGlzLnRhYlF1ZXJ5O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLnRhYnMgPSB0aGlzLnRhYklucHV0O1xuXHRcdH1cblxuXHRcdHRoaXMudGFicy5mb3JFYWNoKHRhYiA9PiB0YWIuY2FjaGVBY3RpdmUgPSB0aGlzLmNhY2hlQWN0aXZlKTtcblx0XHR0aGlzLnRhYnMuY2hhbmdlcy5zdWJzY3JpYmUoKCkgPT4ge1xuXHRcdFx0dGhpcy5zZXRGaXJzdFRhYigpO1xuXHRcdH0pO1xuXHRcdHRoaXMuc2V0Rmlyc3RUYWIoKTtcblx0fVxuXG5cdG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcblx0XHRpZiAodGhpcy50YWJzICYmIGNoYW5nZXMuY2FjaGVBY3RpdmUpIHtcblx0XHRcdHRoaXMudGFicy5mb3JFYWNoKHRhYiA9PiB0YWIuY2FjaGVBY3RpdmUgPSB0aGlzLmNhY2hlQWN0aXZlKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogQ29udHJvbHMgbWFudWFsbHkgZm9jdXNpbmcgdGFicy5cblx0ICovXG5cdHB1YmxpYyBvblRhYkZvY3VzKHJlZjogSFRNTEVsZW1lbnQsIGluZGV4OiBudW1iZXIpIHtcblx0XHR0aGlzLmN1cnJlbnRTZWxlY3RlZFRhYiA9IGluZGV4O1xuXHRcdC8vIHJlc2V0IHNjcm9sbCBsZWZ0IGJlY2F1c2Ugd2UncmUgYWxyZWFkeSBoYW5kbGluZyBpdFxuXHRcdHRoaXMuaGVhZGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudC5zY3JvbGxMZWZ0ID0gMDtcblx0fVxuXG5cdHB1YmxpYyBnZXRTZWxlY3RlZFRhYigpOiBhbnkge1xuXHRcdGNvbnN0IHNlbGVjdGVkID0gdGhpcy50YWJzLmZpbmQodGFiID0+IHRhYi5hY3RpdmUpO1xuXHRcdGlmIChzZWxlY3RlZCkge1xuXHRcdFx0cmV0dXJuIHNlbGVjdGVkO1xuXHRcdH1cblx0XHRyZXR1cm4geyBoZWFkaW5nSXNUZW1wbGF0ZTogZmFsc2UsIGhlYWRpbmc6IFwiXCIgfTtcblx0fVxuXG5cdC8qKlxuXHQgKiBTZWxlY3RzIGBUYWJgICd0YWInIGFuZCBtb3ZlcyBpdCBpbnRvIHZpZXcgb24gdGhlIHZpZXcgRE9NIGlmIGl0IGlzIG5vdCBhbHJlYWR5LlxuXHQgKi9cblx0cHVibGljIHNlbGVjdFRhYihyZWY6IEhUTUxFbGVtZW50LCB0YWI6IFRhYiwgdGFiSW5kZXg6IG51bWJlcikge1xuXHRcdGlmICh0YWIuZGlzYWJsZWQpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHR0aGlzLmN1cnJlbnRTZWxlY3RlZFRhYiA9IHRhYkluZGV4O1xuXHRcdHRoaXMudGFicy5mb3JFYWNoKF90YWIgPT4gX3RhYi5hY3RpdmUgPSBmYWxzZSk7XG5cdFx0dGFiLmFjdGl2ZSA9IHRydWU7XG5cdFx0dGFiLmRvU2VsZWN0KCk7XG5cdH1cblxuXHRwdWJsaWMgaGFuZGxlU2Nyb2xsKCkge1xuXHRcdHRoaXMuY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XG5cdH1cblxuXHRwdWJsaWMgaGFuZGxlT3ZlcmZsb3dOYXZDbGljayhkaXJlY3Rpb246IG51bWJlciwgbXVsdGlwbGllciA9IDE1KSB7XG5cdFx0Y29uc3QgdGFiTGlzdCA9IHRoaXMuaGVhZGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQ7XG5cblx0XHRjb25zdCB7IGNsaWVudFdpZHRoLCBzY3JvbGxMZWZ0LCBzY3JvbGxXaWR0aCB9ID0gdGFiTGlzdDtcblx0XHRpZiAoZGlyZWN0aW9uID09PSAxICYmICFzY3JvbGxMZWZ0KSB7XG5cdFx0XHR0YWJMaXN0LnNjcm9sbExlZnQgKz0gdGhpcy5PVkVSRkxPV19CVVRUT05fT0ZGU0VUO1xuXHRcdH1cblxuXHRcdHRhYkxpc3Quc2Nyb2xsTGVmdCArPSBkaXJlY3Rpb24gKiBtdWx0aXBsaWVyO1xuXG5cdFx0Y29uc3QgbGVmdEVkZ2VSZWFjaGVkID1cblx0XHRcdGRpcmVjdGlvbiA9PT0gLTEgJiYgc2Nyb2xsTGVmdCA8IHRoaXMuT1ZFUkZMT1dfQlVUVE9OX09GRlNFVDtcblx0XHRjb25zdCByaWdodEVkZ2VSZWFjaGVkID1cblx0XHRcdGRpcmVjdGlvbiA9PT0gMSAmJlxuXHRcdFx0c2Nyb2xsTGVmdCArIGNsaWVudFdpZHRoID49IHNjcm9sbFdpZHRoIC0gdGhpcy5PVkVSRkxPV19CVVRUT05fT0ZGU0VUO1xuXG5cdFx0aWYgKGxlZnRFZGdlUmVhY2hlZCkge1xuXHRcdFx0dGhpcy5yaWdodE92ZXJmbG93TmF2QnV0dG9uLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcblx0XHR9XG5cdFx0aWYgKHJpZ2h0RWRnZVJlYWNoZWQpIHtcblx0XHRcdHRoaXMubGVmdE92ZXJmbG93TmF2QnV0dG9uLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgaGFuZGxlT3ZlcmZsb3dOYXZNb3VzZURvd24oZGlyZWN0aW9uOiBudW1iZXIpIHtcblx0XHRjb25zdCB0YWJMaXN0ID0gdGhpcy5oZWFkZXJDb250YWluZXIubmF0aXZlRWxlbWVudDtcblxuXHRcdHRoaXMub3ZlcmZsb3dOYXZJbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcblx0XHRcdGNvbnN0IHsgY2xpZW50V2lkdGgsIHNjcm9sbExlZnQsIHNjcm9sbFdpZHRoIH0gPSB0YWJMaXN0O1xuXG5cdFx0XHQvLyBjbGVhciBpbnRlcnZhbCBpZiBzY3JvbGwgcmVhY2hlcyBsZWZ0IG9yIHJpZ2h0IGVkZ2Vcblx0XHRcdGNvbnN0IGxlZnRFZGdlUmVhY2hlZCA9IGRpcmVjdGlvbiA9PT0gLTEgJiYgc2Nyb2xsTGVmdCA8IHRoaXMuT1ZFUkZMT1dfQlVUVE9OX09GRlNFVDtcblx0XHRcdGNvbnN0IHJpZ2h0RWRnZVJlYWNoZWQgPVxuXHRcdFx0XHRkaXJlY3Rpb24gPT09IDEgJiZcblx0XHRcdFx0c2Nyb2xsTGVmdCArIGNsaWVudFdpZHRoID49IHNjcm9sbFdpZHRoIC0gdGhpcy5PVkVSRkxPV19CVVRUT05fT0ZGU0VUO1xuXG5cdFx0XHRpZiAobGVmdEVkZ2VSZWFjaGVkIHx8IHJpZ2h0RWRnZVJlYWNoZWQpIHtcblx0XHRcdFx0Y2xlYXJJbnRlcnZhbCh0aGlzLm92ZXJmbG93TmF2SW50ZXJ2YWwpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBhY2NvdW50IGZvciBvdmVyZmxvdyBidXR0b24gYXBwZWFyaW5nIGFuZCBjYXVzaW5nIHRhYmxpc3Qgd2lkdGggY2hhbmdlXG5cdFx0XHR0aGlzLmhhbmRsZU92ZXJmbG93TmF2Q2xpY2soZGlyZWN0aW9uKTtcblx0XHR9KTtcblx0fVxuXG5cdHB1YmxpYyBoYW5kbGVPdmVyZmxvd05hdk1vdXNlVXAoKSB7XG5cdFx0Y2xlYXJJbnRlcnZhbCh0aGlzLm92ZXJmbG93TmF2SW50ZXJ2YWwpO1xuXHR9XG5cblx0LyoqXG5cdCAqIERldGVybWluZXMgd2hpY2ggYFRhYmAgaXMgaW5pdGlhbGx5IHNlbGVjdGVkLlxuXHQgKi9cblx0cHJvdGVjdGVkIHNldEZpcnN0VGFiKCkge1xuXHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0bGV0IGZpcnN0VGFiID0gdGhpcy50YWJzLmZpbmQodGFiID0+IHRhYi5hY3RpdmUpO1xuXHRcdFx0aWYgKCFmaXJzdFRhYiAmJiB0aGlzLnRhYnMuZmlyc3QpIHtcblx0XHRcdFx0Zmlyc3RUYWIgPSB0aGlzLnRhYnMuZmlyc3Q7XG5cdFx0XHRcdGZpcnN0VGFiLmFjdGl2ZSA9IHRydWU7XG5cdFx0XHR9XG5cdFx0XHRpZiAoZmlyc3RUYWIpIHtcblx0XHRcdFx0Zmlyc3RUYWIuZG9TZWxlY3QoKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxufVxuIl19